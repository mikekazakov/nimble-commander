name: Build and Test
on: [workflow_dispatch]
jobs:
  run-unit-tests:
    runs-on: macos-13
    env:
      XC_VERSION: ${{ '15.1' }}
      CCACHE_DIR: "~/.ccache"
      CCACHE_COMPRESS: "true"
      CCACHE_COMPRESSLEVEL: "6"
      CCACHE_MAXSIZE: "400M"
    strategy:
      matrix:
        configuration: ["Debug", "Release"]
    steps:
    - name: Select latest Xcode
      run: "sudo xcode-select -s /Applications/Xcode_$XC_VERSION.app"
    - name: Install ccache
      run: "brew install ccache"
    - uses: actions/checkout@v2
    - name: Build and run unit tests
      run: "cd Scripts && ./run_all_unit_tests.sh ${{ matrix.configuration }}"
    - name: Show ccache stats
      run: "ccache --show-stats"
    - name: Cache ccache
      uses: actions/cache@v2
      with:
        path: ~/.ccache
        key: ccache-${{ runner.os }}-${{ github.job }}-${{ matrix.configuration }}
